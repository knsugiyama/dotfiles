---
#cloud config

locale: en_US.UTF8
timezone: Asia/Tokyo
package_update: true
package_upgrade: true

users:
  - name: ubuntu
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh-authorized-keys:
      - AUTHORIZED_KEYS

packages:
  - docker
  - avahi-daemon
  - apt-transport-https
  - ca-certificates
  - curl
  - gnupg
  - lsb-release
  - build-essential
  - unzip

runcmd:
  # docker
  - sudo curl -fsSL https://get.docker.com | sudo bash
  - sudo systemctl enable docker
  - sudo systemctl enable -s HUP ssh
  - sudo groupadd docker
  - sudo usermod -aG docker ubuntu
  # CF Cli
  - curl -fsSL https://packages.cloudfoundry.org/debian/cli.cloudfoundry.org.key | sudo gpg --dearmor -o /etc/apt/keyrings/cli.cloudfoundry.org.key
  - echo "deb [signed-by=/etc/apt/keyrings/cli.cloudfoundry.org.key] https://packages.cloudfoundry.org/debian stable main" | sudo tee /etc/apt/sources.list.d/cloudfoundry-cli.list
  - sudo apt-get update
  - sudo apt-get install cf8-cli
  # BTP Cli
  - curl -b eula_3_1_agreed=tools.hana.ondemand.com/developer-license-3_1.txt "https://tools.hana.ondemand.com/additional/btp-cli-linux-amd64-2.24.0.tar.gz" -o "btp-cli.tar.gz"
  - mkdir $HOME/bin && tar -vxzf btp-cli.tar.gz --strip-components 1 -C $HOME/bin
  - mv $HOME/bin/btp $HOME/bin/btp-2.24.0
  - sudo ln -f -s $HOME/bin/btp-2.24.0 $HOME/bin/btp
  - echo 'export PATH="$PATH:$HOME/bin"' >> ~/.bashrc
  - rm -f btp-cli.tar.gz
  # AWS Cli
  - curl "https://awscli.amazonaws.com/awscli-exe-linux-$(uname -m).zip" -o "awscliv2.zip"
  - unzip awscliv2.zip
  - sudo ./aws/install
  - rm -rf awscliv2.zip aws
